//= require leaflet
//= require leaflet.map


// ancienne fonction pour generer la map google.maps
/* var map;
function myMap() {
  var mapProp= {
    center:new google.maps.LatLng(51.508742,-0.120850),
    zoom:5,
  };

  map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
}
 */

// fonction pour les inputs
/*
let verif = function() {

  let index = 0;
  let length = $('#input')[0].childNodes.length - 1
  let bool = true;
  while (index < length ) {
    if ( $('#input')[0].childNodes[index].childNodes[0].value == "" )
      bool = false;
    index++;
  }

  if (bool)
    return (1);
  else {
    alert('Il manque un/des parametres pour ajouter le marqueur');
    return (0);
  }
}

let index = 0;
let ids = ['latitude', 'longitude', 'message', 'bouton'];
let type = ['input', 'input', 'input' , 'button'];

a = document.createElement('div');
$(a).addClass("Map")
  .appendTo($('body'))

b = document.createElement('ul');
$(b).addClass("Map")
  .attr('id', 'input')
  .appendTo($(a))

c = document.createElement('div')
$(c).appendTo($(a))
  .attr('id', 'googleMap')
  .height('400px')
  .width('80%')
  .position('relative')


while (index < ids.length)
{
  a = document.createElement('li');
  $(a).appendTo($(b));

  c = document.createElement(type[index])
  $(c).appendTo($(a))
    .attr('id', ids[index])

  if (type[index] === 'input' )
    $(c)[0].placeholder = ids[index];

  index++;
}


$('#bouton:eq(0)')[0].innerHTML = "Ajout marqueur";
$('#bouton:eq(0)').click(function() {
  if (verif()) {
    let latitude = $('#input')[0].childNodes[0].childNodes[0].value;
    let longitude = $('#input')[0].childNodes[1].childNodes[0].value;
    var place = new google.maps.LatLng(latitude, longitude);
    var marker = new google.maps.Marker({position: place});
    var infowindow = new google.maps.InfoWindow({
      content: longitude = $('#input')[0].childNodes[2].childNodes[0].value });
    google.maps.event.addListener(marker, 'click', function() {
      infowindow.open(map,marker);
    }); 
    marker.setMap(map);
  }
});

*/

let container = $('#mapid:eq(0)')
let mymap = L.map('mapid').setView([51.505, -0.09], 13);

let layer = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
  attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
  maxZoom: 18,
  transparent: true,
  id: 'mapbox.streets',
  accessToken: 'pk.eyJ1IjoiYmZyYWlraW4iLCJhIjoiY2podWxwc21pMG5udjNqdDZpZGluaGhxeSJ9.WaMLYylJhk6ULiaGSWNuAA',
}).addTo(mymap);


// musée du 1er call ajax

c = document.createElement('button');
$(c).appendTo($('body'))
  .click(function() {
    bound = mymap.getBounds(); 
    $.ajax({url: "/", type: 'POST', data: 'Nlat=' + bound.getNorthEast().lat + "&Nlong=" + bound.getNorthWest().lng + "&Slat=" + bound.getSouthEast().lat + "&Slong=" + bound.getSouthWest()  , dataType: 'JSON', body: 'caca', complete: ( function(data) {
      let place;
      //    for (let local of data.responseJSON.caca) {

      place = new L.latLng(bound.getNorthEast().lat, bound.getNorthWest().lng);
      let myIcon = new L.icon({ iconUrl: '//app/assets/images/boutique.jpg', iconSize: [38, 40],  iconAnchor: [22, 94] });
      let marker = new L.Marker(place, {icon: myIcon, autoPan: true}).addTo(mymap);
      marker.addTo(mymap);
      //  };
      //   map.setCenter({lat: data.responseJSON.caca[0].longitude, lng: data.responseJSON.caca[0].latitude });
    })
    });})
  .attr('id', 'coucou')
